<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Ketchup Snapshot Diff</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="utopia.css">
  <link rel="stylesheet" href="snapshots.css">
</head>
<body>
  <h1>Ketchup Snapshot Diff</h1>
  <div class="tab-bar">
    <% snapshots_by_viewport.each_with_index do |(viewport, _), i| -%>
    <button class="tab<%= " active" if i == 0 %>" data-viewport="<%= viewport %>"><%= viewport.capitalize %></button>
    <% end -%>
  </div>
  <% snapshots_by_viewport.each_with_index do |(viewport, snapshots), i| -%>
  <div class="viewport-group<%= " hidden" unless i == 0 %>" data-viewport="<%= viewport %>">
    <% snapshots.each do |snap| %>
    <% entry = snap.current || snap.baseline -%>
    <div class="snapshot">
      <h2>
        <%= snap.name %>
        <% unless snap.baseline %>
        <span class="label new">new</span>
        <% end -%>
        <% unless snap.current %>
        <span class="label removed">removed</span>
        <% end -%>
      </h2>
      <code class="path"><%= entry.path %><%= " #{entry.selector}" if entry.selector %></code>
      <div class="pair">
        <div class="side">
          <h3>Baseline</h3>
          <% if snap.baseline %>
          <img src="baseline/<%= viewport %>/<%= snap.name %>.png" alt="baseline <%= snap.name %>">
          <% else %>
          <div class="placeholder">No baseline</div>
          <% end %>
        </div>
        <div class="side">
          <h3>Current</h3>
          <% if snap.current %>
          <img src="current/<%= viewport %>/<%= snap.name %>.png" alt="current <%= snap.name %>">
          <% else %>
          <div class="placeholder">Removed</div>
          <% end %>
        </div>
      </div>
    </div>
    <% end %>
  </div>
  <% end -%>
  <div class="lightbox" id="lightbox"><img></div>
  <script>
    document.querySelector(".tab-bar").addEventListener("click", function(e) {
      if (!e.target.matches(".tab")) return;
      var viewport = e.target.dataset.viewport;
      document.querySelectorAll(".tab").forEach(function(t) { t.classList.toggle("active", t.dataset.viewport === viewport); });
      document.querySelectorAll(".viewport-group").forEach(function(g) { g.classList.toggle("hidden", g.dataset.viewport !== viewport); });
    });

    var lightbox = document.getElementById("lightbox");
    document.addEventListener("click", function(e) {
      if (e.target.matches(".snapshot img, .side img")) {
        lightbox.querySelector("img").src = e.target.src;
        lightbox.classList.add("open");
      } else if (lightbox.classList.contains("open")) {
        lightbox.classList.remove("open");
      }
    });
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") lightbox.classList.remove("open");
    });
  </script>
</body>
</html>
