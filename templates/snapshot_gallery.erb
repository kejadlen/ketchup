<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title><%= title %></title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="utopia.css">
  <link rel="stylesheet" href="snapshots.css">
</head>
<body>
  <h1><%= title %></h1>
  <div class="tab-bar">
    <% images_by_viewport.each_with_index do |(viewport, _), i| -%>
    <button class="tab<%= " active" if i == 0 %>" data-viewport="<%= viewport %>"><%= viewport.capitalize %></button>
    <% end -%>
  </div>
  <% images_by_viewport.each_with_index do |(viewport, images), i| -%>
  <div class="viewport-group<%= " hidden" unless i == 0 %>" data-viewport="<%= viewport %>">
    <% images.each do |image| %>
    <div class="snapshot">
      <h2><%= image[:entry].name %></h2>
      <code class="path"><%= image[:entry].path %><%= " #{image[:entry].selector}" if image[:entry].selector %></code>
      <img src="<%= image[:filename] %>" alt="<%= image[:entry].name %>">
    </div>
    <% end %>
  </div>
  <% end -%>
  <div class="lightbox" id="lightbox"><img></div>
  <script>
    document.querySelector(".tab-bar").addEventListener("click", function(e) {
      if (!e.target.matches(".tab")) return;
      var viewport = e.target.dataset.viewport;
      document.querySelectorAll(".tab").forEach(function(t) { t.classList.toggle("active", t.dataset.viewport === viewport); });
      document.querySelectorAll(".viewport-group").forEach(function(g) { g.classList.toggle("hidden", g.dataset.viewport !== viewport); });
    });

    var lightbox = document.getElementById("lightbox");
    document.addEventListener("click", function(e) {
      if (e.target.matches(".snapshot img")) {
        lightbox.querySelector("img").src = e.target.src;
        lightbox.classList.add("open");
      } else if (lightbox.classList.contains("open")) {
        lightbox.classList.remove("open");
      }
    });
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") lightbox.classList.remove("open");
    });
  </script>
</body>
</html>
